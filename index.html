<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <title>外卖成本系统 · 首页</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
  <div class="container">
    <a class="navbar-brand" href="index.html">干饭人外卖成本系统</a>
    <div>
      <a class="btn btn-outline-light me-2" href="purchases.html">采购</a>
      <a class="btn btn-outline-light me-2" href="dishes.html">菜品</a>
      <a class="btn btn-outline-light me-2" href="settings.html">售价设置</a>
      <a class="btn btn-outline-light" href="profit.html">利润计算器</a>
      <a class="btn btn-outline-light" href="sales.html">销售记录</a>
    </div>
  </div>
</nav>

<main class="container py-5">
  <div class="text-center">
    <h1>干饭人外卖成本和利润管理</h1>
    <p class="lead">多页版 · Bootstrap UI · 数据存储在 Supabase 在线数据库</p>
    <p>建议先在 <a href="purchases.html">采购</a> 中录入食材，然后到 <a href="dishes.html">菜品</a> 定义菜谱，最后到 <a href="profit.html">利润</a> 测算。</p>
    <div id="dbStatus" class="mt-4"></div>
  </div>
</main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<!-- Supabase SDK -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
  // ------------------------------
  // 1️⃣ 初始化 Supabase
  // ------------------------------
  const SUPABASE_URL = "https://YOUR_SUPABASE_PROJECT_URL.supabase.co";
  const SUPABASE_KEY = "YOUR_ANON_PUBLIC_KEY";
  const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

  // ------------------------------
  // 2️⃣ 测试数据库连接
  // ------------------------------
  async function checkDatabase() {
    const statusEl = document.getElementById("dbStatus");
    try {
      // 查询食材数量
      let { count: ingredientCount, error: ingErr } = await supabase
        .from('ingredients')
        .select('*', { count: 'exact', head: true });
      if (ingErr) throw ingErr;

      // 查询采购记录数量
      let { count: purchaseCount, error: purErr } = await supabase
        .from('purchase_records')
        .select('*', { count: 'exact', head: true });
      if (purErr) throw purErr;

      statusEl.innerHTML = `
        <div class="alert alert-success">
          数据库连接成功！<br>
          当前共有 <strong>${ingredientCount}</strong> 种食材，<strong>${purchaseCount}</strong> 条采购记录。
        </div>
      `;
    } catch (err) {
      statusEl.innerHTML = `<div class="alert alert-danger">数据库连接失败：${err.message}</div>`;
      console.error(err);
    }
  }

  document.addEventListener('DOMContentLoaded', checkDatabase);
</script>
</body>
</html>
